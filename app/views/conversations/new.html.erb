<div class="max-w-2xl mx-auto p-6">
  <div class="bg-white shadow rounded-xl overflow-hidden">
    <div class="px-6 py-4 border-b">
      <h2 class="text-xl font-semibold text-gray-900">New Conversation</h2>
    </div>

    <div class="px-6 py-5">
      <%= form_with model: @conversation, url: conversations_path, method: :post, data: { turbo: false }, class: "space-y-5" do |f| %>
        <%= f.hidden_field :conversation_type, value: :group_chat %>

        <div>
          <%= f.label :title, "Group Name", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_field :title,
                class: "block w-full rounded-lg border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                placeholder: "e.g. Product Team",
                required: true %>
        </div>

        <div>
          <label for="user-select" class="block text-sm font-medium text-gray-700 mb-1">Add Members</label>
          <select id="user-select" name="conversation[user_ids][]" multiple
                  class="w-full rounded-lg border border-gray-300">
            <% @users.each do |user| %>
              <option value="<%= user.id %>"><%= user.username %></option>
            <% end %>
          </select>
          <p class="mt-1 text-xs text-gray-500">Search and select multiple users.</p>
        </div>

        <div class="pt-2">
          <%= f.submit "Create Group",
                class: "inline-flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  document.addEventListener('turbo:load', function() {
    if (window.SlimSelect) {
      new SlimSelect({
        select: '#user-select',
        settings: {
          placeholderText: 'Select members...',
          searchPlaceholder: 'Search users...',
          searchText: 'No results',
          searchingText: 'Searching...',
          closeOnSelect: false
        }
      });
    }
  });
</script>